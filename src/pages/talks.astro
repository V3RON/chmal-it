---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import { Image } from "@unpic/astro";
import TalkCard from "@/components/TalkCard.astro";
import { generateBlurhashPlaceholder } from "@/lib/blurhash";

import talk1 from "@/assets/talks/talk-1.jpeg";
import talk2 from "@/assets/talks/talk-2.jpeg";
import talk3 from "@/assets/talks/talk-3.jpeg";
import talk4 from "@/assets/talks/talk-4.jpeg";

const talks = (await getCollection("talks")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf()
);

const imageData = [
  { img: talk1, path: "src/assets/talks/talk-1.jpeg" },
  { img: talk2, path: "src/assets/talks/talk-2.jpeg" },
  { img: talk3, path: "src/assets/talks/talk-3.jpeg" },
  { img: talk4, path: "src/assets/talks/talk-4.jpeg" },
];

const imagesWithPlaceholders = await Promise.all(
  imageData.map(async (item) => ({
    ...item,
    placeholder: await generateBlurhashPlaceholder(item.path),
  }))
);
---

<BaseLayout title="Talks" description="My public speaking history.">
  <div class="flex flex-col items-start gap-4 md:flex-row md:justify-between md:gap-8">
    <div class="flex-1 space-y-4">
      <h1 class="inline-block font-heading text-4xl font-bold tracking-tight lg:text-5xl text-gradient">
        Talks
      </h1>
      <p class="text-xl text-muted-foreground">
        Conferences, meetups, and workshops I've spoken at.
      </p>
    </div>
  </div>

  {/* Bento Grid Mosaic */}
  <div class="mt-8 grid grid-cols-1 gap-4 sm:grid-cols-2 md:grid-cols-4">
    {imagesWithPlaceholders.map(({ img, placeholder }, i) => (
      <div class="group relative aspect-video overflow-hidden rounded-xl border border-border/50 bg-muted md:aspect-square">
        <Image 
          src={img} 
          alt={`Talk photo ${i + 1}`} 
          class="h-full w-full object-cover transition-all duration-500 group-hover:scale-105 filter grayscale hover:grayscale-0"
          width={600}
          height={600}
          background={placeholder}
        />
        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>
      </div>
    ))}
  </div>

  <hr class="my-12 border-border/40" />

  <div class="space-y-8">
    {
      talks.map((talk) => (
        <TalkCard talk={talk} />
      ))
    }
  </div>
</BaseLayout>